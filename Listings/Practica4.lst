A51 MACRO ASSEMBLER  PRACTICA4                                                            07/12/2021 11:35:05 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\Practica4.obj
ASSEMBLER INVOKED BY: D:\Keil_v5\C51\BIN\A51.EXE Practica4.a51 SET(SMALL) DEBUG PRINT(.\Listings\Practica4.lst) OBJECT(.
                      \Objects\Practica4.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     ;PRACTICA 4
                       2     ;P2: BUS DE DATOS DE LCD
                       3     ;P3.6: RS - LCD
                       4     ;P3.7: E - LCD
                       5     
                       6     ;P1:3 - P1.0: D - A DE 74C922
                       7     
                       8     ;P3.1: PUERTO SERIAL
                       9     ;P3.2: LECTURA DE MATRIZ
                      10     ;P3.3: ASCII MODE
                      11     
                      12     ;TIMER 1 - DELAY 100 us
                      13     
                      14     ;R7: N VECES QUE SE REPITE TIMER 100 uS
                      15     ;R6: CANTIDAD DE CARACTERES impresos (LCD)
                      16     ;R5: CARACTER PRUEBA
                      17     
  0060                18     DIR_DATOS equ 60H
  0200                19     DIR_CONVERTION equ 0200H
  00B6                20     RS equ P3.6
  00B7                21     E equ P3.7
                      22     
0000                  23     ORG 0H
0000 803E             24             SJMP START
                      25             
                      26     ;EXTERNAL 0
0003                  27     ORG 0003H
0003 C289             28             CLR IE0
                      29             ;Leer dato
0005 11C4             30             ACALL READ_MATRICIAL
                      31             
                      32             ;Imprimir dato
0007 1191             33             ACALL LCD_WRITE 
                      34             
                      35             ;Guardar dato
0009 11D0             36             ACALL SAVE_DATA
                      37             
000B 32               38     RETI
                      39             
                      40     ;TIMER 0
                      41     ;ORG 000BH
                      42     ;RETI
                      43     
                      44     ;EXTERNAL 1
0013                  45     ORG 0013H
0013 32               46     RETI
                      47     
                      48     ;TIMER 1
                      49     ;ORG 001BH
                      50     ;RETI
                      51     
                      52     ;SERIAL PORT
0023                  53     ORG 0023H
0023 32               54     RETI
                      55             
                      56     
0040                  57     ORG 40H
A51 MACRO ASSEMBLER  PRACTICA4                                                            07/12/2021 11:35:05 PAGE     2

0040                  58     START:
                      59     ;CONF TIMER
                      60     ;                               T1                                      T0      
                      61     ;                       GATE !T/C M1 M0         GATE !T/C M1 M0 
0040 758911           62             MOV TMOD, #00010001b
                      63             
                      64     ;CONF INTERRUPCIONES
                      65     ;               EA - ET2 ES ET1 EX1 ET0 EX0
0043 75A895           66     MOV IE, #10010101b
0046 D288             67     setb IT0
0048 D28A             68     SETB IT1
004A 7860             69     MOV R0, #DIR_DATOS
004C 8799             70     MOV SBUF, @R1
                      71     
                      72     ;CONF SERIAL
                      73     
                      74     
004E 1155             75             ACALL LCD_INICIALIZATION
                      76             
0050                  77     MAIN:
                      78             ;PUEDEN UTILIZAR ESTE ESPACIO PARA PRUEBAS, SIEMPRE Y CUANDO DEJEN EL CODIGO COMO D
                             EBERÍA IR.
                      79             
0050 20B5FD           80             JB P3.5, MAIN
                      81             
0053 80FB             82             SJMP MAIN
                      83             
                      84             
0055                  85     LCD_INICIALIZATION:
                      86             ;38H - 39 us, RS = 0
                      87             ;0FH - 39 us, RS = 0
                      88             ;01H - 1.53 ms, RS = 0
0055 C2B6             89             CLR RS; !COMANDO / DATO
0057 C2B7             90             CLR E
0059 75A001           91             MOV P2, #01H
005C 7F11             92             MOV R7, #17D
005E D2B7             93             SETB E ; E 
0060 11B4             94             ACALL DELAY
0062 C2B7             95             CLR E; E        
                      96     
0064 75A038           97             MOV P2, #38H
0067 7F01             98             MOV R7, #01h; cantidad de veces que se repite t_0
0069 D2B7             99             SETB E; E 
006B 11B4            100             ACALL DELAY
006D C2B7            101             CLR E; E
                     102             
006F 75A038          103             MOV P2, #38H
0072 7F01            104             MOV R7, #01h
0074 D2B7            105             SETB E ; E 
0076 11B4            106             ACALL DELAY
0078 C2B7            107             CLR E; E
                     108             
007A 75A00F          109             MOV P2, #0FH
007D 7F01            110             MOV R7, #01h
007F D2B7            111             SETB E; E 
0081 11B4            112             ACALL DELAY
0083 C2B7            113             CLR E; E
                     114     
0085 75A080          115             MOV P2, #80H
0088 7F01            116             MOV R7, #01h
008A D2B7            117             SETB E; E 
008C 11B4            118             ACALL DELAY
008E C2B7            119             CLR E; E
                     120     
0090 22              121             RET
                     122             
A51 MACRO ASSEMBLER  PRACTICA4                                                            07/12/2021 11:35:05 PAGE     3

0091                 123     LCD_WRITE:
                     124     ;PARA ESCRIBIR EN LCD, PASAR AL ACC EL CARACTER A ESCRIBIR
0091 BE1004          125             CJNE R6, #16D, LCD_WRITE_ACC
0094 11A6            126             ACALL LCD_JUMP
0096 7E00            127             MOV R6, #0H
                     128             
0098                 129     LCD_WRITE_ACC:
0098 D2B6            130             SETB RS; !COMANDO / DATO
009A F5A0            131             MOV P2, A; MOVER AL BUS DE LA PANTALLA EL DATO
009C D2B7            132             SETB E; E
009E 7F01            133             MOV R7, #1
00A0 11B4            134             ACALL DELAY
00A2 C2B7            135             CLR E
00A4 0E              136             INC R6
                     137     
00A5 22              138             RET
                     139             
00A6                 140     LCD_JUMP:
00A6 C2B6            141             CLR RS
00A8 75A0C0          142             MOV P2, #0C0H
00AB D2B7            143             SETB E
00AD 7F01            144             MOV R7, #1D
00AF 11B4            145             ACALL DELAY
00B1 C2B7            146             CLR E
00B3 22              147             RET
                     148             
00B4                 149     DELAY:
00B4 758CFF          150             MOV TH0, #HIGH(-100)
00B7 758A9C          151             MOV TL0, #LOW(-100)
00BA D28C            152             SETB TR0
                     153             
00BC                 154     POOLING:
00BC 308DFD          155             JNB TF0, POOLING
00BF C28D            156             CLR TF0
                     157             
00C1 DFF1            158             DJNZ R7, DELAY
                     159             
00C3 22              160             RET
                     161             
00C4                 162     READ_MATRICIAL:
00C4 E590            163             mov A,P1; leer dato
00C6 540F            164             anl A,#0FH; limpiar 
00C8 758302          165             MOV DPH, #HIGH(DIR_CONVERTION)
00CB 758200          166             MOV DPL, #LOW(DIR_CONVERTION)
                     167             
00CE 93              168             MOVC A, @A+DPTR; Mover al acc la conversión
                     169             
00CF 22              170             RET
                     171             
00D0                 172     SAVE_DATA:
00D0 F6              173             mov @R0, A
00D1 08              174             INC R0
00D2 22              175             RET
                     176     
0200                 177             ORG DIR_CONVERTION
0200 44              178             DB 'D'  ;0
0201 42              179             DB 'B'  ;1
0202 43              180             DB 'C'  ;2
0203 41              181             DB 'A'  ;3
0204 30              182             DB '0'  ;4
0205 35              183             DB '5'  ;5
0206 38              184             DB '8'  ;6
0207 32              185             DB '2'  ;7
0208 45              186             DB 'E'  ;8
0209 36              187             DB '6'  ;9
020A 39              188             DB '9'  ;10
A51 MACRO ASSEMBLER  PRACTICA4                                                            07/12/2021 11:35:05 PAGE     4

020B 33              189             DB '3'  ;11
020C 46              190             DB 'F'  ;12
020D 34              191             DB '4'  ;13
020E 37              192             DB '7'  ;14     
020F 31              193             DB '1'  ;15
                     194             
                     195             END
A51 MACRO ASSEMBLER  PRACTICA4                                                            07/12/2021 11:35:05 PAGE     5

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

DELAY. . . . . . .  C ADDR   00B4H   A   
DIR_CONVERTION . .  N NUMB   0200H   A   
DIR_DATOS. . . . .  N NUMB   0060H   A   
DPH. . . . . . . .  D ADDR   0083H   A   
DPL. . . . . . . .  D ADDR   0082H   A   
E. . . . . . . . .  B ADDR   00B0H.7 A   
IE . . . . . . . .  D ADDR   00A8H   A   
IE0. . . . . . . .  B ADDR   0088H.1 A   
IT0. . . . . . . .  B ADDR   0088H.0 A   
IT1. . . . . . . .  B ADDR   0088H.2 A   
LCD_INICIALIZATION  C ADDR   0055H   A   
LCD_JUMP . . . . .  C ADDR   00A6H   A   
LCD_WRITE. . . . .  C ADDR   0091H   A   
LCD_WRITE_ACC. . .  C ADDR   0098H   A   
MAIN . . . . . . .  C ADDR   0050H   A   
P1 . . . . . . . .  D ADDR   0090H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
P3 . . . . . . . .  D ADDR   00B0H   A   
POOLING. . . . . .  C ADDR   00BCH   A   
READ_MATRICIAL . .  C ADDR   00C4H   A   
RS . . . . . . . .  B ADDR   00B0H.6 A   
SAVE_DATA. . . . .  C ADDR   00D0H   A   
SBUF . . . . . . .  D ADDR   0099H   A   
START. . . . . . .  C ADDR   0040H   A   
TF0. . . . . . . .  B ADDR   0088H.5 A   
TH0. . . . . . . .  D ADDR   008CH   A   
TL0. . . . . . . .  D ADDR   008AH   A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR0. . . . . . . .  B ADDR   0088H.4 A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
