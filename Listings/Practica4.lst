A51 MACRO ASSEMBLER  PRACTICA4                                                            07/12/2021 18:09:29 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\Practica4.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE Practica4.a51 SET(SMALL) DEBUG PRINT(.\Listings\Practica4.lst) OBJECT(.
                      \Objects\Practica4.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     ;PRACTICA 4
                       2     ;P2: BUS DE DATOS DE LCD
                       3     ;P3.6: RS - LCD
                       4     ;P3.7: E - LCD
                       5     
                       6     ;P1:3 - P1.0: D - A DE 74C922
                       7     
                       8     ;P3.1: PUERTO SERIAL
                       9     ;P3.2: LECTURA DE MATRIZ
                      10     ;P3.3: ASCII MODE
                      11     
                      12     ;TIMER 1 - DELAY 100 us
                      13     
                      14     ;R7: N VECES QUE SE REPITE TIMER 100 uS
                      15     ;R6: CANTIDAD DE CARACTERES impresos (LCD)
                      16     ;R5: CARACTER PRUEBA
                      17     
  0060                18     DIR_DATOS equ 60H
  0200                19     DIR_CONVERTION equ 0200H
  00B6                20     RS equ P3.6
  00B7                21     E equ P3.7
                      22     
0000                  23     ORG 0H
0000 803E             24             SJMP START
                      25             
                      26     ;EXTERNAL 0
0003                  27     ORG 0003H
0003 C289             28             CLR IE0
                      29             ;Leer dato
0005 11DD             30             ACALL READ_MATRICIAL
                      31             
                      32             ;Imprimir dato
0007 1195             33             ACALL LCD_WRITE 
                      34             
                      35             ;Guardar dato
0009 11E9             36             ACALL SAVE_DATA
                      37             
000B 32               38     RETI
                      39             
                      40     ;TIMER 0
                      41     ;ORG 000BH
                      42     ;RETI
                      43     
                      44     ;EXTERNAL 1
0013                  45     ORG 0013H
0013 C28B             46             CLR IE1
0015 11D6             47             ACALL ENVIAR
0017 32               48     RETI
                      49     
                      50     ;TIMER 1
                      51     ;ORG 001BH
                      52     ;RETI
                      53     
                      54     ;SERIAL PORT
0023                  55     ORG 0023H
0023 32               56     RETI
                      57             
A51 MACRO ASSEMBLER  PRACTICA4                                                            07/12/2021 18:09:29 PAGE     2

                      58     
0040                  59     ORG 40H
0040                  60     START:
                      61             ;CONF TIMER
0040 758DFD           62             MOV TH1, #-3
                      63             ;                               T1                                      T0      
                      64             ;                       GATE !T/C M1 M0         GATE !T/C M1 M0 
0043 758921           65             MOV TMOD, #00100001b 
                      66             
                      67             ;CONF INTERRUPCIONES
                      68             ;               EA - ET2 ES ET1 EX1 ET0 EX0
0046 75A895           69             MOV IE, #10010101b
0049 D288             70             setb IT0
004B D28A             71             SETB IT1
004D 7860             72             MOV R0, #DIR_DATOS
                      73     
                      74             ;CONF SERIAL
004F 759840           75             MOV SCON, #01000000B    ;UART 8 BITS BANDERAS LIMPIAS
                      76     
0052 1159             77             ACALL LCD_INICIALIZATION
                      78             
0054                  79     MAIN:
                      80             ;PUEDEN UTILIZAR ESTE ESPACIO PARA PRUEBAS, SIEMPRE Y CUANDO DEJEN EL CODIGO COMO D
                             EBERÍA IR.
                      81             
0054 20B5FD           82             JB P3.5, MAIN
                      83             
0057 80FB             84             SJMP MAIN
                      85             
                      86             
0059                  87     LCD_INICIALIZATION:
                      88             ;38H - 39 us, RS = 0
                      89             ;0FH - 39 us, RS = 0
                      90             ;01H - 1.53 ms, RS = 0
0059 C2B6             91             CLR RS; !COMANDO / DATO
005B C2B7             92             CLR E
005D 75A001           93             MOV P2, #01H
0060 7F11             94             MOV R7, #17D
0062 D2B7             95             SETB E ; E 
0064 11B8             96             ACALL DELAY
0066 C2B7             97             CLR E; E        
                      98     
0068 75A038           99             MOV P2, #38H
006B 7F01            100             MOV R7, #01h; cantidad de veces que se repite t_0
006D D2B7            101             SETB E; E 
006F 11B8            102             ACALL DELAY
0071 C2B7            103             CLR E; E
                     104             
0073 75A038          105             MOV P2, #38H
0076 7F01            106             MOV R7, #01h
0078 D2B7            107             SETB E ; E 
007A 11B8            108             ACALL DELAY
007C C2B7            109             CLR E; E
                     110             
007E 75A00F          111             MOV P2, #0FH
0081 7F01            112             MOV R7, #01h
0083 D2B7            113             SETB E; E 
0085 11B8            114             ACALL DELAY
0087 C2B7            115             CLR E; E
                     116     
0089 75A080          117             MOV P2, #80H
008C 7F01            118             MOV R7, #01h
008E D2B7            119             SETB E; E 
0090 11B8            120             ACALL DELAY
0092 C2B7            121             CLR E; E
                     122     
A51 MACRO ASSEMBLER  PRACTICA4                                                            07/12/2021 18:09:29 PAGE     3

0094 22              123             RET
                     124             
0095                 125     LCD_WRITE:
                     126     ;PARA ESCRIBIR EN LCD, PASAR AL ACC EL CARACTER A ESCRIBIR
0095 BE1004          127             CJNE R6, #16D, LCD_WRITE_ACC
0098 11AA            128             ACALL LCD_JUMP
009A 7E00            129             MOV R6, #0H
                     130             
009C                 131     LCD_WRITE_ACC:
009C D2B6            132             SETB RS; !COMANDO / DATO
009E F5A0            133             MOV P2, A; MOVER AL BUS DE LA PANTALLA EL DATO
00A0 D2B7            134             SETB E; E
00A2 7F01            135             MOV R7, #1
00A4 11B8            136             ACALL DELAY
00A6 C2B7            137             CLR E
00A8 0E              138             INC R6
                     139     
00A9 22              140             RET
                     141             
00AA                 142     LCD_JUMP:
00AA C2B6            143             CLR RS
00AC 75A0C0          144             MOV P2, #0C0H
00AF D2B7            145             SETB E
00B1 7F01            146             MOV R7, #1D
00B3 11B8            147             ACALL DELAY
00B5 C2B7            148             CLR E
00B7 22              149             RET
                     150             
00B8                 151     DELAY:
00B8 758CFF          152             MOV TH0, #HIGH(-100)
00BB 758A9C          153             MOV TL0, #LOW(-100)
00BE D28C            154             SETB TR0
                     155             
00C0                 156     POOLING:
00C0 308DFD          157             JNB TF0, POOLING
00C3 C28D            158             CLR TF0
                     159             
00C5 DFF1            160             DJNZ R7, DELAY
                     161             
00C7 22              162             RET
                     163             
00C8                 164     ENVIAR_DATO: 
00C8 D28E            165             SETB TR1 
00CA D2B5            166             SETB T1
00CC 8799            167             MOV SBUF, @R1           
00CE 3099FD          168             JNB TI, $ ;SI NO TERMINA DE TRANSMITIR BRINCA A SI MISMO
00D1 C299            169             CLR TI
00D3 09              170             INC R1  ;AUMENTAMOS EL NUMERO DE DATOS ENVIADOS
00D4 8002            171             SJMP ENV        
                     172     
00D6                 173     ENVIAR:         ;R1 DIRECCION DATO A ENVIAR, R0: DIRECCION MAXIMA, R4: DATOS ENVIADOS
00D6 7960            174             MOV R1, #DIR_DATOS      ;DIR DE DATO A ENVIAR
00D8                 175     ENV:    
00D8 E9              176             MOV A, R1                       ;DIR DE DATO A ENVIAR
00D9 B500EC          177             CJNE A, 0, ENVIAR_DATO   
00DC 22              178             RET
                     179             
00DD                 180     READ_MATRICIAL:
00DD E590            181             mov A,P1; leer dato
00DF 540F            182             anl A,#0FH; limpiar 
00E1 758302          183             MOV DPH, #HIGH(DIR_CONVERTION)
00E4 758200          184             MOV DPL, #LOW(DIR_CONVERTION)
                     185             
00E7 93              186             MOVC A, @A+DPTR; Mover al acc la conversión
                     187             
00E8 22              188             RET
A51 MACRO ASSEMBLER  PRACTICA4                                                            07/12/2021 18:09:29 PAGE     4

                     189             
00E9                 190     SAVE_DATA:
00E9 F6              191             mov @R0, A
00EA 08              192             INC R0
00EB 22              193             RET
                     194     
0200                 195             ORG DIR_CONVERTION
0200 44              196             DB 'D'  ;0
0201 42              197             DB 'B'  ;1
0202 43              198             DB 'C'  ;2
0203 41              199             DB 'A'  ;3
0204 30              200             DB '0'  ;4
0205 35              201             DB '5'  ;5
0206 38              202             DB '8'  ;6
0207 32              203             DB '2'  ;7
0208 45              204             DB 'E'  ;8
0209 36              205             DB '6'  ;9
020A 39              206             DB '9'  ;10
020B 33              207             DB '3'  ;11
020C 46              208             DB 'F'  ;12
020D 34              209             DB '4'  ;13
020E 37              210             DB '7'  ;14     
020F 31              211             DB '1'  ;15
                     212             
                     213             END
A51 MACRO ASSEMBLER  PRACTICA4                                                            07/12/2021 18:09:29 PAGE     5

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

DELAY. . . . . . .  C ADDR   00B8H   A   
DIR_CONVERTION . .  N NUMB   0200H   A   
DIR_DATOS. . . . .  N NUMB   0060H   A   
DPH. . . . . . . .  D ADDR   0083H   A   
DPL. . . . . . . .  D ADDR   0082H   A   
E. . . . . . . . .  B ADDR   00B0H.7 A   
ENV. . . . . . . .  C ADDR   00D8H   A   
ENVIAR . . . . . .  C ADDR   00D6H   A   
ENVIAR_DATO. . . .  C ADDR   00C8H   A   
IE . . . . . . . .  D ADDR   00A8H   A   
IE0. . . . . . . .  B ADDR   0088H.1 A   
IE1. . . . . . . .  B ADDR   0088H.3 A   
IT0. . . . . . . .  B ADDR   0088H.0 A   
IT1. . . . . . . .  B ADDR   0088H.2 A   
LCD_INICIALIZATION  C ADDR   0059H   A   
LCD_JUMP . . . . .  C ADDR   00AAH   A   
LCD_WRITE. . . . .  C ADDR   0095H   A   
LCD_WRITE_ACC. . .  C ADDR   009CH   A   
MAIN . . . . . . .  C ADDR   0054H   A   
P1 . . . . . . . .  D ADDR   0090H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
P3 . . . . . . . .  D ADDR   00B0H   A   
POOLING. . . . . .  C ADDR   00C0H   A   
READ_MATRICIAL . .  C ADDR   00DDH   A   
RS . . . . . . . .  B ADDR   00B0H.6 A   
SAVE_DATA. . . . .  C ADDR   00E9H   A   
SBUF . . . . . . .  D ADDR   0099H   A   
SCON . . . . . . .  D ADDR   0098H   A   
START. . . . . . .  C ADDR   0040H   A   
T1 . . . . . . . .  B ADDR   00B0H.5 A   
TF0. . . . . . . .  B ADDR   0088H.5 A   
TH0. . . . . . . .  D ADDR   008CH   A   
TH1. . . . . . . .  D ADDR   008DH   A   
TI . . . . . . . .  B ADDR   0098H.1 A   
TL0. . . . . . . .  D ADDR   008AH   A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR0. . . . . . . .  B ADDR   0088H.4 A   
TR1. . . . . . . .  B ADDR   0088H.6 A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
